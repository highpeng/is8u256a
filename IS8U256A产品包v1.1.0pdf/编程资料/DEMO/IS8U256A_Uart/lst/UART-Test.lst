C51 COMPILER V9.02   UART_TEST                                                             12/11/2014 10:39:21 PAGE 1   


C51 COMPILER V9.02, COMPILATION OF MODULE UART_TEST
OBJECT MODULE PLACED IN .\obj\UART-Test.obj
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE src\UART-Test.C LARGE BROWSE DEBUG OBJECTEXTEND PRINT(.\lst\UART-Test.lst) 
                    -OBJECT(.\obj\UART-Test.obj)

line level    source

   1          
   2          #include "..\inc\IS8U256X.h"
   3          
   4          #include "..\inc\IS8U256A_UART.h"
   5          
   6          #include "..\inc\IS8U256A_GPIO.h"
   7          
   8          unsigned char xdata count=0x0;
   9          unsigned char xdata rx_buff[256]={0x0};
  10          unsigned char xdata rxflag=0x0,txflag=0x0;
  11          unsigned char xdata RxFlag0=0x0;
  12          unsigned char xdata i=0x0;
  13          
  14          void main(void)
  15          {
  16   1              unsigned int i=0x0;
  17   1      
  18   1              CFCR = 0x12;
  19   1      
  20   1              GPIOInit();
  21   1      
  22   1              GPIOSetOutput(GPIO_PIN_19|GPIO_PIN_20);
  23   1      
  24   1              UARTInit();
  25   1      
  26   1      
  27   1              while(1)
  28   1              {
  29   2                      if(RxFlag0)
  30   2                      {
  31   3                              RxFlag0 = 0x0;
  32   3      
  33   3                              for(i=0;i<count;i++)
  34   3                                      UARTSendByte(rx_buff[i]);
  35   3      
  36   3                              count=0x0;
  37   3      
  38   3                      }
  39   2              }
  40   1      }
  41          
  42          void UARTHandler(void) interrupt 13
  43          {
  44   1              /*关闭总中断*/
  45   1              IEH &= 0x7F;    
  46   1      
  47   1              /*处理接收中断*/
  48   1              if(UARTSR&0x02)
  49   1              {
  50   2                      /*没有接收错误*/
  51   2                      if(!(UARTSR&0x38))
  52   2                      {
  53   3                              /*读取数据并清除接收中断标志*/
  54   3                              rx_buff[count]=RX_DATA;
C51 COMPILER V9.02   UART_TEST                                                             12/11/2014 10:39:21 PAGE 2   

  55   3      
  56   3                              if(count!=rx_buff[4]+5)
  57   3                              {
  58   4                                      count++;
  59   4                              }
  60   3                              else
  61   3                              {
  62   4                                      RxFlag0=0xFF;
  63   4                              }
  64   3      
  65   3                              if(rxflag)
  66   3                              {
  67   4                                      rxflag = 0x0;
  68   4                                      GPIOSet(GPIO_PIN_20);
  69   4                              }
  70   3                              else
  71   3                              {
  72   4                                      rxflag = 0xff;
  73   4                                      GPIOReset(GPIO_PIN_20);
  74   4                              }
  75   3      
  76   3                      }
  77   2                      /*数据接收错误*/
  78   2                      else
  79   2                      {
  80   3                              
  81   3                      }
  82   2              }
  83   1      
  84   1              /*处理发送中断*/
  85   1              if(UARTSR&0x04)
  86   1              {
  87   2                      /*清除发送中断标志*/
  88   2                      UARTSR &= 0xFB;
  89   2      
  90   2                      if(txflag)
  91   2                      {
  92   3                              txflag = 0x0;
  93   3                              GPIOSet(GPIO_PIN_19);
  94   3                      }
  95   2                      else
  96   2                      {
  97   3                              txflag = 0xff;
  98   3                              GPIOReset(GPIO_PIN_19);
  99   3                      }
 100   2              }
 101   1      
 102   1              /*恢复总中断*/
 103   1              IEH |= 0x80;
 104   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    298    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =    261       2
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
